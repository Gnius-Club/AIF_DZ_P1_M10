<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Red M√°gica - Kids Edition</title>
    <style>
        /* --- EST√âTICA DIVERTIDA Y ESPACIAL --- */
        :root {
            --bg-deep: #1a0b2e;
            --neon-blue: #00f3ff;
            --neon-pink: #ff00cc;
            --neon-green: #39ff14;
            --neon-yellow: #fff01f;
            --overlay-bg: rgba(0, 0, 0, 0.85);
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--bg-deep);
            /* Estrellas animadas en CSS */
            background-image: 
                radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 4px),
                radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 2px);
            background-size: 550px 550px, 350px 350px;
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif; /* Fuente amigable */
            touch-action: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Animaci√≥n de fondo */
        @keyframes spaceMove {
            from { background-position: 0 0, 0 0; }
            to { background-position: -50px -50px, -30px -30px; }
        }
        body { animation: spaceMove 20s linear infinite; }

        /* --- CAPAS --- */
        #game-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        #particles-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }

        /* --- ELEMENTOS DE JUEGO --- */
        svg { width: 100%; height: 100%; }
        
        .connection-line {
            stroke: var(--neon-yellow);
            stroke-width: 12; /* M√°s grueso para ni√±os */
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: drop-shadow(0 0 8px var(--neon-yellow));
            transition: stroke 0.3s;
        }
        
        .temp-line {
            stroke: var(--neon-blue);
            stroke-dasharray: 20, 10;
            opacity: 0.7;
            animation: dash 1s linear infinite;
        }

        @keyframes dash { to { stroke-dashoffset: -30; } }

        .planet {
            position: absolute;
            width: 90px; /* M√°s grandes */
            height: 90px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fff, #5e72eb);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 50px;
            box-shadow: 0 0 20px rgba(94, 114, 235, 0.6), inset -5px -5px 10px rgba(0,0,0,0.3);
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 5;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 4px solid white;
        }

        .planet:active { transform: translate(-50%, -50%) scale(0.9); }
        .planet.pop { animation: pop 0.4s ease; }
        
        @keyframes pop {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.3); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* Burbuja de pensamiento (ICONOS en vez de texto) */
        .thought-bubble {
            position: absolute;
            top: -70px;
            background: white;
            border-radius: 20px;
            padding: 5px 15px;
            font-size: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            animation: float 3s ease-in-out infinite;
            border: 3px solid var(--neon-pink);
            pointer-events: none;
        }
        .thought-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 10px 10px 0;
            border-style: solid;
            border-color: var(--neon-pink) transparent transparent transparent;
        }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* --- PERSONAJE ROBOT TUTORIAL --- */
        #robot-guide {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, #ddd, #999);
            border-radius: 50%;
            border: 5px solid var(--neon-blue);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 70px;
            z-index: 100;
            box-shadow: 0 0 20px var(--neon-blue);
            pointer-events: auto;
            transition: transform 0.2s;
        }
        #robot-guide.talking { animation: talk 0.2s infinite alternate; }
        @keyframes talk { from { transform: scale(1); } to { transform: scale(1.05); } }

        /* --- UI OVERLAY & DIALOGOS --- */
        #dialog-box {
            position: absolute;
            bottom: 30px;
            left: 160px; /* Al lado del robot */
            right: 20px;
            background: white;
            border-radius: 30px;
            padding: 20px;
            border: 5px solid var(--neon-blue);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            pointer-events: auto;
            max-width: 600px;
        }

        #dialog-text {
            font-size: 1.5rem;
            color: #333;
            margin: 0 0 15px 0;
            font-weight: bold;
        }

        /* Bot√≥n Siguiente (Flecha gigante) */
        .big-btn {
            background: var(--neon-green);
            border: none;
            padding: 10px 40px;
            border-radius: 50px;
            font-size: 2rem;
            color: #000;
            cursor: pointer;
            box-shadow: 0 5px 0 #2db30e;
            transition: transform 0.1s;
            align-self: flex-end;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .big-btn:active { transform: translateY(5px); box-shadow: none; }
        .big-btn span { font-size: 1.2rem; font-weight: bold; }

        /* MANO FANTASMA TUTORIAL */
        #ghost-hand {
            position: absolute;
            font-size: 80px;
            pointer-events: none;
            z-index: 50;
            display: none;
            filter: drop-shadow(0 0 10px white);
        }

        @keyframes hand-drag {
            0% { transform: translate(0, 0) scale(1); }
            20% { transform: translate(0, 0) scale(0.9); } /* Press */
            80% { transform: translate(var(--tx), var(--ty)) scale(0.9); } /* Drag */
            100% { transform: translate(var(--tx), var(--ty)) scale(1); opacity: 0; } /* Release */
        }

        /* PART√çCULAS */
        .particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            animation: fadeOut 1s forwards;
        }
        @keyframes fadeOut { to { opacity: 0; transform: scale(0); } }

        /* PANTALLA INICIO */
        #start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 200;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }
        #start-screen h1 { font-size: 3rem; color: var(--neon-yellow); text-shadow: 0 0 10px red; text-align: center; }

    </style>
</head>
<body>

    <!-- Pantalla de Inicio (Necesaria para habilitar audio y voz) -->
    <div id="start-screen">
        <h1>üåå Red M√°gica üåå</h1>
        <p style="font-size: 1.5rem;">¬°Conecta los corazones!</p>
        <button class="big-btn" onclick="startGame()">
            <span>JUGAR</span> ‚ñ∂Ô∏è
        </button>
    </div>

    <div id="game-container">
        <svg id="connections-layer"></svg>
        <!-- Planetas inyectados por JS -->
    </div>

    <!-- Capa de efectos -->
    <div id="particles-layer"></div>

    <!-- UI -->
    <div id="ui-layer">
        <!-- Robot Gu√≠a -->
        <div id="robot-guide">ü§ñ</div>
        
        <!-- Caja de Di√°logo -->
        <div id="dialog-box" style="display: none;">
            <p id="dialog-text">...</p>
            <button id="dialog-btn" class="big-btn">‚ñ∂Ô∏è</button>
        </div>

        <!-- Mano Tutorial -->
        <div id="ghost-hand">üëÜ</div>
    </div>

    <canvas id="confetti-canvas" style="position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:999;"></canvas>

    <script>
        // --- DATOS DEL JUEGO (Simplificados para ni√±os) ---
        const LEVELS = [
            {
                id: 1,
                narrative: [
                    "¬°Hola! Soy Robo. ü§ñ",
                    "La ni√±a extra√±a a su abuela. üò¢",
                    "¬°Ayuda a conectarlas! ‚ö°"
                ],
                hint: "Arrastra de la ni√±a a la abuela",
                planets: [
                    { id: 'girl', emoji: 'üëß', want: 'üëµ', x: 20, y: 50 },
                    { id: 'grandma', emoji: 'üëµ', want: 'üëß', x: 80, y: 50 }
                ],
                connections: [['girl', 'grandma']]
            },
            {
                id: 2,
                narrative: [
                    "¬°Bien hecho! üéâ",
                    "Mira, un coche de carreras. üèéÔ∏è",
                    "¬°Quiere jugar con el ni√±o gamer! üéÆ"
                ],
                hint: "Conecta los juguetes",
                planets: [
                    { id: 'gamer', emoji: 'üéÆ', want: 'üèéÔ∏è', x: 30, y: 30 },
                    { id: 'car', emoji: 'üèéÔ∏è', want: 'üéÆ', x: 70, y: 70 }
                ],
                connections: [['gamer', 'car']]
            },
            {
                id: 3,
                narrative: [
                    "¬°Eres genial! üåü",
                    "El Profe quiere ense√±ar Dinosaurios. ü¶ñ",
                    "¬°Conecta a TODOS los ni√±os con el Profe!"
                ],
                hint: "Une al profe con los 3 ni√±os",
                planets: [
                    { id: 'teach', emoji: 'üë®‚Äçüè´', want: 'üéì', x: 50, y: 20 },
                    { id: 'k1', emoji: 'üë¶', want: 'ü¶ñ', x: 20, y: 80 },
                    { id: 'k2', emoji: 'üëß', want: 'ü¶ñ', x: 50, y: 80 },
                    { id: 'k3', emoji: 'üßë', want: 'ü¶ñ', x: 80, y: 80 }
                ],
                connections: [['teach', 'k1'], ['teach', 'k2'], ['teach', 'k3']]
            },
            {
                id: 4,
                narrative: [
                    "¬°√öltima misi√≥n! üöÄ",
                    "Es el cumple del Le√≥n. ü¶Å",
                    "¬°Lleva la fiesta al Le√≥n!"
                ],
                hint: "M√∫sica y pastel para el le√≥n",
                planets: [
                    { id: 'lion', emoji: 'ü¶Å', want: '‚ù§Ô∏è', x: 50, y: 50 },
                    { id: 'music', emoji: 'üé∏', want: 'ü¶Å', x: 15, y: 20 },
                    { id: 'cake', emoji: 'üéÇ', want: 'ü¶Å', x: 85, y: 20 },
                    { id: 'balloons', emoji: 'üéà', want: 'ü¶Å', x: 50, y: 85 }
                ],
                connections: [['music', 'lion'], ['cake', 'lion'], ['balloons', 'lion']]
            }
        ];

        // --- ESTADO GLOBAL ---
        let currentLevelIdx = 0;
        let dialogueStep = 0;
        let isGameplayActive = false;
        let activeLine = null;
        let startPlanet = null;
        let completedPairs = [];
        let synth = window.speechSynthesis;
        let voice = null;

        // Elementos DOM
        const gameContainer = document.getElementById('game-container');
        const svgLayer = document.getElementById('connections-layer');
        const dialogBox = document.getElementById('dialog-box');
        const dialogText = document.getElementById('dialog-text');
        const dialogBtn = document.getElementById('dialog-btn');
        const robot = document.getElementById('robot-guide');
        const ghostHand = document.getElementById('ghost-hand');

        // --- INICIO ---
        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            // Intentar obtener voz en espa√±ol
            let voices = synth.getVoices();
            voice = voices.find(v => v.lang.startsWith('es')) || voices[0];
            
            initAudioContext(); // Habilitar audio Web Audio API
            loadLevel(0);
        }

        // --- SISTEMA DE NIVELES Y DI√ÅLOGO ---
        function loadLevel(idx) {
            currentLevelIdx = idx;
            dialogueStep = 0;
            completedPairs = [];
            isGameplayActive = false;
            
            // Limpiar
            gameContainer.querySelectorAll('.planet').forEach(e => e.remove());
            svgLayer.innerHTML = '';
            
            if (idx >= LEVELS.length) {
                congratulateFinish();
                return;
            }

            const level = LEVELS[idx];

            // Renderizar Planetas
            level.planets.forEach(p => {
                const el = document.createElement('div');
                el.className = 'planet';
                el.id = p.id;
                el.innerHTML = `${p.emoji} <div class="thought-bubble">${p.want}</div>`;
                el.style.left = p.x + '%';
                el.style.top = p.y + '%';
                // Animaci√≥n de entrada
                el.style.transform = 'translate(-50%, -50%) scale(0)';
                setTimeout(() => el.style.transform = 'translate(-50%, -50%) scale(1)', 100 + Math.random()*300);
                
                // Eventos
                el.addEventListener('mousedown', onDragStart);
                el.addEventListener('touchstart', onDragStart, {passive: false});
                
                gameContainer.appendChild(el);
            });

            // Iniciar Narrativa
            showDialog();
        }

        function showDialog() {
            const level = LEVELS[currentLevelIdx];
            
            // Si acabamos los di√°logos, empieza el juego
            if (dialogueStep >= level.narrative.length) {
                dialogBox.style.display = 'none';
                isGameplayActive = true;
                showTutorialHand(); // Mostrar ayuda visual si es necesario
                return;
            }

            dialogBox.style.display = 'flex';
            const text = level.narrative[dialogueStep];
            dialogText.textContent = text;
            speak(text);

            dialogBtn.onclick = () => {
                dialogueStep++;
                showDialog();
            };
        }

        function speak(text) {
            if (synth.speaking) synth.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            if (voice) utter.voice = voice;
            utter.rate = 0.9; // Un poco m√°s lento para ni√±os
            utter.pitch = 1.2; // Voz m√°s amigable
            
            robot.classList.add('talking');
            utter.onend = () => robot.classList.remove('talking');
            
            synth.speak(utter);
        }

        function showTutorialHand() {
            // Solo mostrar mano en el nivel 1 o si el usuario no hace nada en 5 segundos
            if (currentLevelIdx === 0) {
                const p1 = document.querySelector('.planet'); // Primer planeta
                const p2 = document.querySelectorAll('.planet')[1]; // Segundo
                
                if(!p1 || !p2) return;

                const r1 = p1.getBoundingClientRect();
                const r2 = p2.getBoundingClientRect();

                ghostHand.style.display = 'block';
                ghostHand.style.left = (r1.left + r1.width/2 - 40) + 'px';
                ghostHand.style.top = (r1.top + r1.height/2 - 40) + 'px';
                
                // Calcular distancia para la animaci√≥n CSS
                const tx = (r2.left - r1.left) + 'px';
                const ty = (r2.top - r1.top) + 'px';
                
                ghostHand.style.setProperty('--tx', tx);
                ghostHand.style.setProperty('--ty', ty);
                ghostHand.style.animation = 'hand-drag 2s infinite';
            }
        }

        // --- L√ìGICA DEL JUEGO (DRAW TO CONNECT) ---

        function onDragStart(e) {
            if (!isGameplayActive) return;
            e.preventDefault();
            
            // Ocultar tutorial si el ni√±o toca
            ghostHand.style.display = 'none';

            const target = e.currentTarget;
            playTone(400, 'sine'); // Sonido pop
            target.classList.add('pop');
            setTimeout(() => target.classList.remove('pop'), 200);

            startPlanet = target.id;
            const center = getCenter(target);

            // Crear l√≠nea
            activeLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
            activeLine.setAttribute("x1", center.x);
            activeLine.setAttribute("y1", center.y);
            activeLine.setAttribute("x2", center.x);
            activeLine.setAttribute("y2", center.y);
            activeLine.classList.add("connection-line", "temp-line");
            svgLayer.appendChild(activeLine);

            document.addEventListener('mousemove', onDragMove);
            document.addEventListener('touchmove', onDragMove, {passive: false});
            document.addEventListener('mouseup', onDragEnd);
            document.addEventListener('touchend', onDragEnd);
        }

        function onDragMove(e) {
            if (!activeLine) return;
            e.preventDefault(); // Prevenir scroll

            const pt = getCoords(e);
            activeLine.setAttribute("x2", pt.x);
            activeLine.setAttribute("y2", pt.y);
        }

        function onDragEnd(e) {
            document.removeEventListener('mousemove', onDragMove);
            document.removeEventListener('touchmove', onDragMove);
            document.removeEventListener('mouseup', onDragEnd);
            document.removeEventListener('touchend', onDragEnd);

            if (!activeLine) return;

            // Detectar si solt√≥ sobre un planeta
            const pt = getCoords(e, true); // true = raw client coords for elementFromPoint
            const elBelow = document.elementFromPoint(pt.cx, pt.cy);
            const planetBelow = elBelow ? elBelow.closest('.planet') : null;

            let success = false;

            if (planetBelow && planetBelow.id !== startPlanet) {
                // Validar conexi√≥n
                const pair = [startPlanet, planetBelow.id].sort().join('-');
                const levelData = LEVELS[currentLevelIdx];
                const isValid = levelData.connections.some(c => [...c].sort().join('-') === pair);
                const isDone = completedPairs.includes(pair);

                if (isValid && !isDone) {
                    success = true;
                    // Fijar l√≠nea
                    const c1 = getCenter(document.getElementById(startPlanet));
                    const c2 = getCenter(planetBelow);
                    
                    activeLine.setAttribute("x2", c2.x);
                    activeLine.setAttribute("y2", c2.y);
                    activeLine.classList.remove("temp-line");
                    
                    completedPairs.push(pair);
                    
                    // Efectos de victoria
                    spawnParticles(c2.x, c2.y);
                    planetBelow.classList.add('pop');
                    playSuccessTune();
                    
                    checkWin();
                }
            }

            if (!success) {
                activeLine.remove();
                playTone(150, 'sawtooth', 0.1); // Sonido error suave
            }
            
            activeLine = null;
            startPlanet = null;
        }

        // --- UTILIDADES ---
        function getCoords(e, raw=false) {
            let cx, cy;
            if (e.changedTouches) {
                cx = e.changedTouches[0].clientX;
                cy = e.changedTouches[0].clientY;
            } else {
                cx = e.clientX;
                cy = e.clientY;
            }
            if (raw) return {cx, cy};
            
            const rect = gameContainer.getBoundingClientRect();
            return { x: cx - rect.left, y: cy - rect.top };
        }

        function getCenter(el) {
            const r = el.getBoundingClientRect();
            const cr = gameContainer.getBoundingClientRect();
            return {
                x: r.left + r.width/2 - cr.left,
                y: r.top + r.height/2 - cr.top
            };
        }

        function checkWin() {
            const level = LEVELS[currentLevelIdx];
            if (completedPairs.length === level.connections.length) {
                isGameplayActive = false;
                fireConfetti();
                playWinMusic();
                
                setTimeout(() => {
                    // Mostrar di√°logo de victoria y bot√≥n para siguiente nivel
                    dialogText.textContent = "¬°Yupi! ¬°Conectados! üåü";
                    dialogBtn.innerHTML = "Siguiente ‚ñ∂Ô∏è";
                    dialogBtn.onclick = () => loadLevel(currentLevelIdx + 1);
                    dialogBox.style.display = 'flex';
                    speak("¬°Yupi! ¬°Lo lograste!");
                }, 1000);
            }
        }

        function congratulateFinish() {
            dialogText.textContent = "¬°ERES UN MAESTRO DE LA RED! üèÜ";
            dialogBtn.innerHTML = "Jugar otra vez üîÑ";
            dialogBtn.onclick = () => location.reload();
            dialogBox.style.display = 'flex';
            speak("¬°Felicidades! Eres un maestro de Internet. Gracias por jugar.");
            fireConfetti();
            setInterval(fireConfetti, 2000);
        }

        // --- EFECTOS VISUALES (JUICE) ---
        function spawnParticles(x, y) {
            const colors = ['#00f3ff', '#ff00cc', '#fff01f'];
            for(let i=0; i<10; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                p.style.width = (Math.random()*10 + 5) + 'px';
                p.style.height = p.style.width;
                p.style.background = colors[Math.floor(Math.random()*colors.length)];
                
                // Animaci√≥n JS simple
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 100 + 50;
                const tx = Math.cos(angle) * velocity;
                const ty = Math.sin(angle) * velocity;
                
                p.animate([
                    { transform: 'translate(0,0) scale(1)', opacity: 1 },
                    { transform: `translate(${tx}px, ${ty}px) scale(0)`, opacity: 0 }
                ], { duration: 800, easing: 'ease-out' });
                
                document.getElementById('particles-layer').appendChild(p);
                setTimeout(() => p.remove(), 800);
            }
        }

        // --- AUDIO PROCEDURAL (WEB AUDIO API) ---
        let audioCtx;
        function initAudioContext() {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        function playTone(freq, type, duration=0.1) {
            if(!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playSuccessTune() {
            if(!audioCtx) return;
            const now = audioCtx.currentTime;
            [523.25, 659.25, 783.99, 1046.50].forEach((f, i) => { // C Major Arpeggio
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.value = f;
                gain.gain.setValueAtTime(0.05, now + i*0.1);
                gain.gain.exponentialRampToValueAtTime(0.001, now + i*0.1 + 0.3);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i*0.1);
                osc.stop(now + i*0.1 + 0.3);
            });
        }
        
        function playWinMusic() {
            // Melod√≠a simple de victoria
            if(!audioCtx) return;
            const now = audioCtx.currentTime;
            const notes = [523.25, 659.25, 783.99, 1046.50, 783.99, 1046.50]; 
            notes.forEach((f, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'square';
                osc.frequency.value = f;
                gain.gain.setValueAtTime(0.05, now + i*0.2);
                gain.gain.linearRampToValueAtTime(0, now + i*0.2 + 0.15);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i*0.2);
                osc.stop(now + i*0.2 + 0.2);
            });
        }

        // --- CONFETI SIMPLE ---
        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const pieces = [];
            for(let i=0; i<100; i++) {
                pieces.push({
                    x: canvas.width/2,
                    y: canvas.height/2,
                    vx: (Math.random()-0.5)*20,
                    vy: (Math.random()-0.5)*20 - 10,
                    color: `hsl(${Math.random()*360}, 100%, 50%)`,
                    size: Math.random()*10 + 5
                });
            }
            
            function update() {
                ctx.clearRect(0,0, canvas.width, canvas.height);
                let alive = false;
                pieces.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.5; // Gravedad
                    ctx.fillStyle = p.color;
                    ctx.fillRect(p.x, p.y, p.size, p.size);
                    if(p.y < canvas.height) alive = true;
                });
                if(alive) requestAnimationFrame(update);
                else ctx.clearRect(0,0, canvas.width, canvas.height);
            }
            update();
        }

        // Redimensionar SVG al cambiar ventana
        window.addEventListener('resize', () => {
            document.getElementById('connections-layer').setAttribute('viewBox', `0 0 ${window.innerWidth} ${window.innerHeight}`);
        });

    </script>
</body>
</html>
